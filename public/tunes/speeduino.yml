---
apiVersion: '1.0'

signature: speeduino 202009-dev

constants:
  reqFuel:
    type: scalar
    unit: ms
  algorithm:
    type: bits
    values: [MAP, TPS, IMAP/EMAP]
  divider:
    type: scalar
  alternate:
    type: bits
    values: [Simultaneous, Alternating]
  twoStroke:
    type: bits
    values: [Four-stroke, Two-stroke]
  nCylinders:
    type: bits
    values: [INVALID, 1, 2, 3, 4, 5, 6, INVALID, 8, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID]
  injType:
    type: bits
    values: [Port, Throttle Body]
  nInjectors:
    type: bits
    values: [INVALID, 1, 2, 3, 4, 5, 6, INVALID, 8, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID]
  engineType:
    type: bits
    values: [Even fire, Odd fire]
  stoich:
    type: scalar
    unit: :1
    # TODO: add this to the rest
    max: 14.7
    min: 9
  injLayout:
    type: bits
    values: [Paired, Semi-Sequential, INVALID, Sequential]
  pinLayout:
    type: bits
    values: [Speeduino v0.1, Speeduino v0.2, Speeduino v0.3, Speeduino v0.4, INVALID, INVALID, 01-05 MX5 PNP, INVALID, 96-97 MX5 PNP, NA6 MX5 PNP, Turtana PCB, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, Plazomat I/O 0.1, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, Daz V6 Shield 0.1, BMW PnP, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, NO2C, UA4C, INVALID, INVALID, INVALID, DIY-EFI CORE4 v1.0, INVALID, INVALID, INVALID, INVALID, dvjcodec Teensy RevA, dvjcodec Teensy RevB, INVALID, INVALID, INVALID, Drop Bear, INVALID, INVALID, INVALID, INVALID, Black STM32F407VET6 V0.1, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID, INVALID]
  mapSample:
    type: bits
    values: [Instantaneous, Cycle Average, Cycle Minimum, Event Average]
  oddfire2:
    type: scalar
    unit: deg
  oddfire3:
    type: scalar
    unit: deg
  oddfire4:
    type: scalar
    unit: deg

dialogs:
  - name: engineConstants
    title: Engine Constants
    help:
      link: https://wiki.speeduino.com/en/configuration/Engine_Constants
    groups:
      - name: engineConstants
        title: Engine Constants
        fields:
          - name: reqFuel
            title: Required Fuel
          - name: algorithm
            title: Control Algorithm
            help: Fueling calculation algorithm
          - name: divider
            title: Squirts Per Engine Cycle
          - name: alternate
            title: Injector Staging
            help: |
              Whether or not the injectors should be fired at the same time.
              This setting is ignored when Sequential is selected below, however it will still affect req_fuel value.
          - name: twoStroke
            title: Engine Stroke
            help: Four-stroke (most engines), Two-stroke
          - name: nCylinders
            title: Number of Cylinders
            help: Cylinder count
          - name: injType
            title: Injector Port Type
            help: Port Injection (one injector for each cylinder) or Throttle Body (injectors shared by cylinders)
          - name: nInjectors
            title: Number of Injectors
            help: Number of primary injectors
          - name: engineType
            title: Engine Type
            help: |
              Engines with an equal number of degrees between all firings (This is most engines) should select Even fire.
              Some 2 and 6 cylinder engines are Odd fire however
      - name: board
        title: Board
        fields:
          - name: stoich
            title: Stoichiometric ratio
            help: |
              The stoichiometric ration of the fuel being used.
              For flex fuel, choose the primary fuel.
          - name: injLayout
            title: Injector Layout
            help: |
              The injector layout and timing to be used. Options are:
              1. Paired - 2 injectors per output. Outputs active is equal to half the number of cylinders. Outputs are timed over 1 crank revolution.
              2. Semi-sequential: Same as paired except that injector channels are mirrored (1&4, 2&3) meaning the number of outputs used are equal to the number of cylinders. Only valid for 4 cylinders or less.
              3. Banked: 2 outputs only used.
              4. Sequential: 1 injector per output and outputs used equals the number of cylinders. Injection is timed over full cycle.
          - name: pinLayout
            title: Board Layout
          - name: mapSample
            title: Map Sample method
            help: |
              The method used for calculating the MAP reading.
              - For 1-2 Cylinder engines, Cycle Minimum is recommended.
              - For more than 2 cylinders Cycle Average is recommended.
      - name: oddFireAngles
        title: Odd Fire Angles
        fields:
          - name: oddfire2
            title: Channel 2 angle
            help: |
              The ATDC angle of channel 2 for oddfire engines.
              This is relative to the TDC angle of channel 1
            condition: tune.engineType == 1
          - name: oddfire3
            title: Channel 3 angle
            help: |
              The ATDC angle of channel 3 for oddfire engines.
              This is relative to the TDC angle of channel 1 (NOT channel 2)
            condition: tune.engineType == 1 && tune.nCylinders >= 3
          - name: oddfire4
            title: Channel 4 angle
            help: |
              The ATDC angle of channel 4 for oddfire engines.
              This is relative to the TDC angle of channel 1 (NOT channel 3)
            condition: tune.engineType == 1 && tune.nCylinders >= 4

menus:
  - name: settings
    title: Settings
    subMenus:
      - name: engineConstants
        title: Engine Constants
      - name: injectorCharacteristics
        title: Injector Characteristics
      - name: triggerSetup
        title: Trigger Setup
      - name: airDensity
        title: IAT Density
      - name: barometricCorrection
        title: Barometric Correction
      - name: resetControl
        title: Reset Control
      # - name: separator
      - name: gaugeLimits
        title: Gauge Limits
      # - name: separator
      - name: ioSummary
        title: I/O Summary
      # - name: separator
      - name: programmableOutputs
        title: Programmable outputs

  - name: tuning
    title: Tuning
    subMenus:
      - name: realtimeDisplay
        title: Realtime Display
      - name: accelerationEnrichment
        title: Acceleration Enrichment
      - name: aFRO2
        title: AFR/O2
      - name: engineProtection
        title: Engine Protection
      - name: flexFuel
        title: Flex Fuel
      - name: veTable
        title: VE Table
      - name: sparkTable
        title: Spark Table
      - name: afrTable
        title: AFR Table
      - name: secondFuelTable
        title: Second Fuel Table
      - name: secondSparkTable
        title: Second spark Table
      - name: sequentialFuelTrim
        title: Sequential Fuel trim
      - name: stagedInjection
        title: Staged Injection
      - name: fuelTempCorrection
        title: Fuel Temp Correction

  - name: spark
    title: Spark
    subMenus:
      - name: sparkSettings
        title: Spark Settings
      - name: sparkTable
        title: Spark Table
      - name: dwellSettings
        title: Dwell settings
      - name: dwellCompensation
        title: Dwell Compensation
      - name: iatRetard
        title: IAT Retard
      - name: coldAdvance
        title: Cold Advance
      - name: rotaryIgnition
        title: Rotary Ignition
        condition: sparkMode == 4
